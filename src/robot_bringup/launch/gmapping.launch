<launch>
  <arg name="use_sim_time" default="false"/>
  <param name="/use_sim_time" value="$(arg use_sim_time)"/>

<!-- slam_gmapping은 기본적으로 map → odom TF를 발행 
~map_frame : 보통 "map" (맵의 부모 프레임)

~odom_frame : 보통 "odom" (오도메트리 프레임)

~base_frame : 보통 "base_link" (로봇 바디 프레임)

-->

  <!-- slam_gmapping -->
  <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">

    <!-- 프레임 -->
    <!-- gmapping이 오도메트리를 tf(odom -> base_link로 참조) -->
    <param name="map_frame"  value="map"/>
    <param name="base_frame" value="base_link"/> 
    <param name="odom_frame" value="odom"/>

    <!-- 핵심 업데이트 조건(이동량/회전량/시간) -->
    <param name="linearUpdate"   value="0.10"/>   <!-- m: 이만큼 움직이면 업데이트 -->
    <param name="angularUpdate"  value="0.05"/>   <!-- rad -->
    <param name="temporalUpdate" value="0.50"/>   <!-- s -->

    <!-- 맵 해상도/범위 -->
    <param name="delta" value="0.05"/>            <!-- grid resolution (m/cell) -->
    <!-- (옵션) 맵 범위를 미리 제한하고 싶으면 사용
    <param name="xmin" value="-20.0"/>
    <param name="ymin" value="-20.0"/>
    <param name="xmax" value=" 20.0"/>
    <param name="ymax" value=" 20.0"/>
    -->

    <!-- 라이다 유효 범위(장비에 맞게) -->
    <param name="maxUrange" value="8.0"/>         <!-- 사용 범위(스캔매칭용) -->
    <param name="maxRange"  value="10.0"/>        <!-- 레이저 최대 범위 -->

    <!-- 파티클 수(기본 30~40; 더 도전적이면 올리되 CPU↑) -->
    <param name="particles" value="40"/>

    <!-- 노이즈/운동모델(기본값으로 시작 후 필요시 튜닝)
    <param name="srr" value="0.1"/>
    <param name="srt" value="0.2"/>
    <param name="str" value="0.1"/>
    <param name="stt" value="0.2"/>
    -->

    <!-- 맵 퍼블리시 주기 -->
    <param name="map_update_interval" value="2.0"/>

    <!-- 스캔 토픽 리맵 -->
    <remap from="scan" to="/scan"/>
  </node>
</launch>


<!-- 1. wheel_odo ekf을 먼저 킨다. 
roslaunch robot_bringup wheel_ekf.launch

2. gmapping을 실행한다.
roslaunch robot_bringup gmapping.launch

3. 맵이 그려졌으면, 맵을 저장한다.
rosrun map_server map_saver -f ~/maps/my_map
# => ~/maps/my_map.yaml, my_map.pgm 생성 -->
